<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="8a760d7b-cd17-4b90-8cab-ec1a7fc2bfe9" activeEnvironment="Default" name="TEST_YG_PROFILING_OLD_GROOVY" resourceRoot="" soapui-version="5.5.0" abortOnError="false" runType="SEQUENTIAL" defaultScriptLanguage="Groovy" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:WsdlInterface" id="61c85d01-b9ab-4958-90de-eb06c5f0ad1a" wsaVersion="NONE" name="YG_Profiling_Binding" type="wsdl" bindingName="{http://mlps.gov.it/Services/InformationDelivery/YG_Profiling/1.3}YG_Profiling_Binding" soapVersion="1_1" anonymous="optional" definition="file:/media/vincenzo/Data/VM-share-folder/SIL/WS_ID_YG_Profiling_3.1.wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart="file:/media/vincenzo/Data/VM-share-folder/SIL/WS_ID_YG_Profiling_3.1.wsdl"><con:part><con:url>file:/media/vincenzo/Data/VM-share-folder/SIL/WS_ID_YG_Profiling_3.1.wsdl</con:url><con:content><![CDATA[<WL5G3N0:definitions name="InformationDelivery_YG_Profiling" targetNamespace="http://mlps.gov.it/Services/InformationDelivery/YG_Profiling/1.3" xmlns:WL5G3N0="http://schemas.xmlsoap.org/wsdl/" xmlns:WL5G3N1="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3" xmlns:WL5G3N2="http://mlps.gov.it/Services/InformationDelivery/YG_Profiling/1.3" xmlns:WL5G3N3="http://schemas.xmlsoap.org/wsdl/soap/">
  <WL5G3N0:types>
    <schema xmlns="http://www.w3.org/2001/XMLSchema" xmlns:db="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:tns="http://mlps.gov.it/Services/InformationDelivery/YG_Profiling/1.3" xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/">
      <import namespace="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3" schemaLocation="XS_ID_YG_Profiling_1.3.xsd"/>
    </schema>
  </WL5G3N0:types>
  <WL5G3N0:message name="insert_Input_msg">
    <WL5G3N0:part element="WL5G3N1:Insert_Input" name="insert_Input_msg"/>
  </WL5G3N0:message>
  <WL5G3N0:message name="insert_Output_msg">
    <WL5G3N0:part element="WL5G3N1:YG_ProfilingCollection" name="insert_Output_msg"/>
  </WL5G3N0:message>
  <WL5G3N0:message name="select_Input_msg">
    <WL5G3N0:part element="WL5G3N1:Select_Input" name="select_Input_msg"/>
  </WL5G3N0:message>
  <WL5G3N0:message name="select_Output_msg">
    <WL5G3N0:part element="WL5G3N1:YG_ProfilingCollection" name="select_Output_msg"/>
  </WL5G3N0:message>
  <WL5G3N0:portType name="YG_Profiling_PortType">
    <WL5G3N0:operation name="insert">
      <WL5G3N0:input message="WL5G3N2:insert_Input_msg"/>
      <WL5G3N0:output message="WL5G3N2:insert_Output_msg"/>
    </WL5G3N0:operation>
    <WL5G3N0:operation name="select">
      <WL5G3N0:input message="WL5G3N2:select_Input_msg"/>
      <WL5G3N0:output message="WL5G3N2:select_Output_msg"/>
    </WL5G3N0:operation>
  </WL5G3N0:portType>
  <WL5G3N0:binding name="YG_Profiling_Binding" type="WL5G3N2:YG_Profiling_PortType">
    <WL5G3N3:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/>
    <WL5G3N0:operation name="insert">
      <WL5G3N3:operation soapAction="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/insert"/>
      <WL5G3N0:input>
        <WL5G3N3:body use="literal"/>
      </WL5G3N0:input>
      <WL5G3N0:output>
        <WL5G3N3:body use="literal"/>
      </WL5G3N0:output>
    </WL5G3N0:operation>
    <WL5G3N0:operation name="select">
      <WL5G3N3:operation soapAction="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/select"/>
      <WL5G3N0:input>
        <WL5G3N3:body use="literal"/>
      </WL5G3N0:input>
      <WL5G3N0:output>
        <WL5G3N3:body use="literal"/>
      </WL5G3N0:output>
    </WL5G3N0:operation>
  </WL5G3N0:binding>
  <WL5G3N0:service name="YG_Profiling_BindingQSService">
    <WL5G3N0:port binding="WL5G3N2:YG_Profiling_Binding" name="YG_Profiling_BindingQSPort">
      <WL5G3N3:address location=""/>
    </WL5G3N0:port>
  </WL5G3N0:service>
</WL5G3N0:definitions>]]></con:content><con:type>http://schemas.xmlsoap.org/wsdl/</con:type></con:part><con:part><con:url>file:/media/vincenzo/Data/VM-share-folder/SIL/XS_ID_YG_Profiling_1.3.xsd</con:url><con:content><![CDATA[<xs:schema targetNamespace="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3" elementFormDefault="qualified" attributeFormDefault="qualified" xmlns="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3" xmlns:db="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:simpleType name="Stringa3Obbl">
    <xs:restriction base="xs:string">
      <xs:minLength value="1"/>
      <xs:maxLength value="3"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="Stringa8Obbl">
    <xs:restriction base="xs:string">
      <xs:minLength value="1"/>
      <xs:maxLength value="8"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="CodiceFiscale">
    <xs:restriction base="xs:string">
      <xs:pattern value="[A-Z]{6}[0-9LMNPQRSTUV]{2}[A-Z][0-9LMNPQRSTUV]{2}[A-Z][0-9LMNPQRSTUV]{3}[A-Z]"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="Stringa8">
    <xs:restriction base="xs:string">
      <xs:maxLength value="8"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="Stringa3">
    <xs:restriction base="xs:string">
      <xs:maxLength value="3"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="eta">
    <xs:restriction base="xs:int">
      <xs:totalDigits value="2"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="indice">
    <xs:restriction base="xs:int">
      <xs:totalDigits value="1"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="esito">
    <xs:restriction base="xs:string">
      <xs:enumeration value="E01"/>
      <xs:enumeration value="E02"/>
      <xs:enumeration value="E03"/>
      <xs:enumeration value="E04"/>
      <xs:enumeration value="E05"/>
      <xs:enumeration value="E06"/>
      <xs:enumeration value="E07"/>
      <xs:enumeration value="E08"/>
      <xs:enumeration value="E09"/>
      <xs:enumeration value="E10"/>
      <!--<?E01 = OK (calcolo dell indice andato a buon fine) ?>
      <?E02 = Codice Fiscale non corretto ?>
      <?E03 = Cod. Titolo di Studio non corretto ?>
      <?E04 = Cod. Presenza in Italia non corretto ?>
      <?E05 = Cod. Provincia non corretto ?>
      <?E06 = Cod. Condizione occupazionale non corretto ?>
      <?E07 = Uno o piU input non valorizzati ?>
      <?E08 = Eta non compresa nel range 15-29 ?> 
      <?E09 = Non è possibile ricalcolare l'indice, esiste già una Politica Attiva A02 associata all'utente ?>
	  <?E10 = Indice non presente ?>-->
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="sesso">
    <xs:restriction base="xs:string">
      <xs:enumeration value="M"/>
      <xs:enumeration value="F"/>
      <!--<?M = MASCHIO?>
      <?F = FEMMINA?>-->
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="Stringa50">
    <xs:restriction base="xs:string">
      <xs:maxLength value="50"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:element name="Select_Input" type="Select_Input"/>
  <xs:complexType name="Select_Input">
    <xs:sequence>
      <xs:element name="cf" type="CodiceFiscale" nillable="true"/>
      <xs:element name="provincia" type="Stringa3Obbl" nillable="true"/>
    </xs:sequence>
  </xs:complexType>
  <xs:element name="Insert_Input" type="Insert_Input"/>
  <xs:complexType name="Insert_Input">
    <xs:sequence>
      <xs:element name="cf" type="CodiceFiscale" nillable="true"/>
      <xs:element name="titoloStudio" type="Stringa8Obbl" nillable="true"/>
      <xs:element name="codProv" type="Stringa3Obbl" nillable="true"/>
      <xs:element name="presenzaIt" type="Stringa3Obbl" nillable="true"/>
      <xs:element name="occupazAp" type="Stringa3Obbl" nillable="true"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="YG_Profiling">
    <xs:sequence>
      <xs:element name="cf" type="CodiceFiscale" nillable="true"/>
      <xs:element name="codProv" type="Stringa3" nillable="true"/>
      <xs:element name="dataInserimento" type="xs:dateTime" nillable="true"/>
      <xs:element name="presenzaIt" type="Stringa3" nillable="true"/>
      <xs:element name="occupazAp" type="Stringa3" nillable="true"/>
      <xs:element name="titoloStudio" type="Stringa8" nillable="true"/>
      <xs:element name="codGenere" type="sesso" nillable="true"/>
      <xs:element name="eta" type="eta" nillable="true"/>
      <xs:element name="indice" type="indice" nillable="true"/>
      <xs:element name="desIndice" type="Stringa50" nillable="true"/>
      <xs:element name="indice2" type="indice" nillable="true"/>
      <xs:element name="desIndice2" type="Stringa50" nillable="true"/>
      <xs:element name="esito" type="esito" nillable="true"/>
    </xs:sequence>
  </xs:complexType>
  <xs:element name="YG_ProfilingCollection" type="YG_ProfilingCollection"/>
  <xs:complexType name="YG_ProfilingCollection">
    <xs:sequence>
      <xs:element name="YG_Profiling" type="YG_Profiling" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
  </xs:complexType>
</xs:schema>]]></con:content><con:type>http://www.w3.org/2001/XMLSchema</con:type></con:part></con:definitionCache><con:endpoints><con:endpoint>http://vincenzo-LIFEBOOK-A555:8088/mockYG_Profiling_Binding</con:endpoint></con:endpoints><con:operation id="d3b547b7-75f5-45c7-a723-6b918d2f2070" isOneWay="false" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/insert" name="insert" bindingOperationName="insert" type="Request-Response" inputName="" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call id="12f92da2-a58a-44c0-a216-737bace08913" name="Request_localhost"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8088/mockYG_Profiling_Binding</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns2="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns2:Insert_Input>
         <ns2:cf>DLRVCN69S20F839W</ns2:cf>
         <ns2:titoloStudio>40102004</ns2:titoloStudio>
         <ns2:codProv>058</ns2:codProv>
         <ns2:presenzaIt>A01</ns2:presenzaIt>
         <ns2:occupazAp>A03</ns2:occupazAp>
      </ns2:Insert_Input>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/insert"/><con:wsrmConfig version="1.2"/></con:call><con:call id="523ac10f-7437-4404-964e-d7152bbdca88" name="Request_SIL2"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://sil2:18084/</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns2="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns2:Insert_Input>
         <ns2:cf>DLRVCN69S20F839Q</ns2:cf>
         <ns2:titoloStudio>40102004</ns2:titoloStudio>
         <ns2:codProv>058</ns2:codProv>
         <ns2:presenzaIt>A01</ns2:presenzaIt>
         <ns2:occupazAp>A03</ns2:occupazAp>
      </ns2:Insert_Input>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/insert"/><con:wsrmConfig version="1.2"/></con:call></con:operation><con:operation id="4816857d-0636-4c66-8f3b-0a2189244a18" isOneWay="false" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/select" name="select" bindingOperationName="select" type="Request-Response" inputName="" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call id="c6a937ed-c6bf-4a86-9e2b-a5da89d07e73" name="Request_localhost"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8088/mockYG_Profiling_Binding</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns2="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns2:Select_Input>
         <ns2:cf>DLRVCN69S20F839W</ns2:cf>
         <ns2:provincia>058</ns2:provincia>
      </ns2:Select_Input>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/select"/><con:wsrmConfig version="1.2"/></con:call><con:call id="663b821a-ddba-4e71-b063-e57e2e4165cf" name="Request_SIL2"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://sil2:18084/</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns2="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns2:Select_Input>
         <ns2:cf>DLRVCN69S20F839Q</ns2:cf>
         <ns2:provincia>058</ns2:provincia>
      </ns2:Select_Input>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/select"/><con:wsrmConfig version="1.2"/></con:call></con:operation></con:interface><con:mockService id="91723498-4cf1-4d68-ad56-a1f5f11db4f9" port="8088" path="/mockYG_Profiling_Binding" host="vincenzo-LIFEBOOK-A555" name="YG_Profiling_Binding Mockservice"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.mock.WsdlMockService@require-soap-action">false</con:setting></con:settings><con:startScript/><con:stopScript/><con:properties/><con:onRequestScript>import groovy.sql.Sql

def dbtype = context.expand('${#Project#dbtype}')
def sqlconnection = null

if (dbtype == 'oracle') {
	// connetto il DB oracle
	log.info "Connessione al database oracle in corso..."
	com.eviware.soapui.support.GroovyUtils.registerJdbcDriver("oracle.jdbc.driver.OracleDriver")
	sqlconnection = Sql.newInstance(
		"jdbc:oracle:thin:@"+context.expand('${#Project#dbhost}')+":"+context.expand('${#Project#dbport}')+":"+context.expand('${#Project#dbname}'), 
		context.expand('${#Project#dbusername}'),
		context.expand('${#Project#dbpassword}'), 
		"oracle.jdbc.driver.OracleDriver"
		)
} else if (dbtype == 'postgres') {
	// connetto il DB postgres
	log.info "Connessione al database postgres in corso..."
	com.eviware.soapui.support.GroovyUtils.registerJdbcDriver("org.postgresql.Driver")
	sqlconnection = Sql.newInstance(
		"jdbc:postgresql://"+context.expand('${#Project#dbhost}')+":"+context.expand('${#Project#dbport}')+"/"+context.expand('${#Project#dbname}'), 
		context.expand('${#Project#dbusername}'),
		context.expand('${#Project#dbpassword}'), 
		"org.postgresql.Driver"
		)
} else {
	log.info "Definire la proprietà 'dbtype'. Valori possibili: oracle o postgres";
	return;
}
log.info "Connesso al database " + dbtype
context.dbConnection = sqlconnection
</con:onRequestScript><con:afterRequestScript>import groovy.sql.Sql

// disconnetto il DB
if( context.dbConnection != null ) {
	log.info "Chiusura connessione al database"
	context.dbConnection.close()
}</con:afterRequestScript><con:mockOperation name="select" id="1ef50da1-0f50-4bd4-a198-b646cdb793de" interface="YG_Profiling_Binding" operation="select"><con:settings/><con:defaultResponse>Resp_from_DB</con:defaultResponse><con:dispatchStyle>SCRIPT</con:dispatchStyle><con:dispatchPath>import groovy.sql.Sql
def holder = new com.eviware.soapui.support.XmlHolder( mockRequest.requestContent )

log.info "entro in profilingYG-select"


   // elaboro la richiesta	
   // prelevo il codice fiscale dalla richiesta
   def codicefiscale = holder["//*:cf"].toString()
   //def indexofstart = selectcontainer.indexOf("&lt;ns2:cf>", 1)
   //def indexofend = selectcontainer.indexOf("&lt;/ns2:cf>", 1)
   //def codicefiscale = selectcontainer.substring(indexofstart+16,indexofend)
   log.info "codice fiscale:" + codicefiscale

   if (!context.dbConnection) {
   	log.info "Connessione non disponibile. Verificare la connessione nello script di avvio."
   	return;
   }
   
   // eseguo la query sulla tabella test_soapui.sap con colonne [identificativosap,risposta]
   def row = context.dbConnection.firstRow("select risposta_select from profiling_yg where codicefiscale = ?", [codicefiscale])
   if( row != null )
   {
	// La query restituisce risultati
	context.session = row.risposta_select
     log.info "esco da profilingYG-select"
     return "Resp_from_DB"
   }
   else 
   {
	// La query non restituisce risultati
     log.info "esco da profilingYG-select"
	return "Response_NOT_FOUND"
   }







</con:dispatchPath><con:response name="Response_OK" id="da1bde3a-cf48-4ed4-bdfe-321aeca3e7e9" httpResponseStatus="200" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns:YG_ProfilingCollection  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
         <!--Zero or more repetitions:-->
         <ns:YG_Profiling>
            <ns:cf>DLRVCN69S20F839W</ns:cf>
            <ns:codProv>058</ns:codProv>
            <ns:dataInserimento>2019-03-27T11:28:58.000+01:00</ns:dataInserimento>
            <ns:presenzaIt>A01</ns:presenzaIt>
            <ns:occupazAp>A03</ns:occupazAp>
            <ns:titoloStudio>40102004</ns:titoloStudio>
            <ns:codGenere>M</ns:codGenere>
            <ns:eta>19</ns:eta>
            <ns:indice>1</ns:indice>
            <ns:desIndice>Indice 1 Basso</ns:desIndice>
            <ns:indice2>3</ns:indice2>
            <ns:desIndice2>Indice2 3 Medio-Alto</ns:desIndice2>
            <ns:esito>E01</ns:esito>
         </ns:YG_Profiling>
      </ns:YG_ProfilingCollection>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/select"/></con:response><con:response name="Response_NOT_FOUND" id="da1bde3a-cf48-4ed4-bdfe-321aeca3e7e9" httpResponseStatus="200" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns:YG_ProfilingCollection xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
         <!--Zero or more repetitions:-->
         <ns:YG_Profiling>
            <ns:cf xsi:nil="true"/>
            <ns:codProv xsi:nil="true"/>
            <ns:dataInserimento>2018-10-16T16:19:08.000+02:00</ns0:dataInserimento>
            <ns:presenzaIt xsi:nil="true"/>
            <ns:occupazAp xsi:nil="true"/>
            <ns:titoloStudio xsi:nil="true"/>
            <ns:codGenere xsi:nil="true"/>
            <ns:eta xsi:nil="true"/>
            <ns:indice xsi:nil="true"/>
            <ns:desIndice xsi:nil="true"/>
            <ns:indice2 xsi:nil="true"/>
            <ns:desIndice2 xsi:nil="true"/>
            <ns:esito>E10</ns0:esito>
         </ns:YG_Profiling>
      </ns:YG_ProfilingCollection>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/select"/></con:response><con:response name="Resp_from_DB" id="da1bde3a-cf48-4ed4-bdfe-321aeca3e7e9" httpResponseStatus="200" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
   <soapenv:Header/>
   <soapenv:Body>
      <ns0:YG_ProfilingCollection xmlns:ns0="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
         <!--Zero or more repetitions:-->
         <ns0:YG_Profiling>
            ${session}
         </ns0:YG_Profiling>
      </ns0:YG_ProfilingCollection>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/select"/></con:response><con:dispatchConfig/></con:mockOperation><con:mockOperation name="insert" id="1c106a84-8813-44c0-ba66-e43537bf4c80" interface="YG_Profiling_Binding" operation="insert"><con:settings/><con:defaultResponse>Response_from_DB</con:defaultResponse><con:dispatchStyle>SCRIPT</con:dispatchStyle><con:dispatchPath>import groovy.sql.Sql
def holder = new com.eviware.soapui.support.XmlHolder( mockRequest.requestContent )

log.info "entro in profilingYG-insert"


   // elaboro la richiesta	
   // prelevo il codice fiscale dalla richiesta
   def codicefiscale = holder["//*:cf"].toString()
   //def indexofstart = selectcontainer.indexOf("&lt;ns2:cf>", 1)
   //def indexofend = selectcontainer.indexOf("&lt;/ns2:cf>", 1)
   //def codicefiscale = selectcontainer.substring(indexofstart+16,indexofend)
   log.info "codice fiscale:" + codicefiscale

   if (!context.dbConnection) {
   	log.info "Connessione non disponibile. Verificare la connessione nello script di avvio."
   	return;
   }
   
   // eseguo la query sulla tabella test_soapui.sap con colonne [identificativosap,risposta]
   def row = context.dbConnection.firstRow("select risposta_insert from profiling_yg where codicefiscale = ?", [codicefiscale])
   if( row != null )
   {
	// La query restituisce risultati
	context.session = row.risposta_insert
     log.info "esco da profilingYG-select"
     return "Resp_from_DB"
   }
   else 
   {
     log.info "esco da profilingYG-select"
	return "Response_NOT_FOUND"
   }







</con:dispatchPath><con:response name="Response_OK" id="6215b474-0bb1-4e94-909c-2d7432562df5" httpResponseStatus="200" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns:YG_ProfilingCollection  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
         <!--Zero or more repetitions:-->
         <ns:YG_Profiling>
            <ns:cf>DLRVCN69S20F839W</ns:cf>
            <ns:codProv>058</ns:codProv>
            <ns:dataInserimento>2018-10-16T16:26:17.000+02:00</ns:dataInserimento>
            <ns:presenzaIt>A01</ns:presenzaIt>
            <ns:occupazAp>A03</ns:occupazAp>
            <ns:titoloStudio>40102004</ns:titoloStudio>
            <ns:codGenere>M</ns:codGenere>
            <ns:eta>20</ns:eta>
            <ns:indice>1</ns:indice>
            <ns:desIndice>Indice 1 Basso</ns:desIndice>
            <ns:indice2>3</ns:indice2>
            <ns:desIndice2>Indice2 3 Medio-Alto</ns:desIndice2>
            <ns:esito>E01</ns:esito>
         </ns:YG_Profiling>
      </ns:YG_ProfilingCollection>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/insert"/></con:response><con:response name="Response_NOT_FOUND" id="6215b474-0bb1-4e94-909c-2d7432562df5" httpResponseStatus="200" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns:YG_ProfilingCollection xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
         <!--Zero or more repetitions:-->
         <ns:YG_Profiling>
            <ns:cf xsi:nil="true"/>
            <ns:codProv xsi:nil="true"/>
            <ns:dataInserimento>2019-03-27T11:28:58.000+01:00</ns0:dataInserimento>
            <ns:presenzaIt xsi:nil="true"/>
            <ns:occupazAp xsi:nil="true"/>
            <ns:titoloStudio xsi:nil="true"/>
            <ns:codGenere xsi:nil="true"/>
            <ns:eta xsi:nil="true"/>
            <ns:indice xsi:nil="true"/>
            <ns:desIndice xsi:nil="true"/>
            <ns:indice2 xsi:nil="true"/>
            <ns:desIndice2 xsi:nil="true"/>
            <ns:esito>E08</ns0:esito>
         </ns:YG_Profiling>
      </ns:YG_ProfilingCollection>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/insert"/></con:response><con:response name="Response_from_DB" id="6215b474-0bb1-4e94-909c-2d7432562df5" httpResponseStatus="200" encoding="UTF-8"><con:settings/><con:responseContent><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns0="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3">
   <soapenv:Header/>
   <soapenv:Body>
      <ns0:YG_ProfilingCollection  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
         <!--Zero or more repetitions:-->
         <ns0:YG_Profiling>
            ${session}
         </ns0:YG_Profiling>
      </ns0:YG_ProfilingCollection>
   </soapenv:Body>
</soapenv:Envelope>]]></con:responseContent><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://mlps.gov.it/DataModels/InformationDelivery/YG_Profiling/1.3/insert"/></con:response><con:dispatchConfig/></con:mockOperation></con:mockService><con:properties><con:property><con:name>dbhost</con:name><con:value>migrazione-sil-oracle.westeurope.cloudapp.azure.com</con:value></con:property><con:property><con:name>dbname</con:name><con:value>ORAMIG12</con:value></con:property><con:property><con:name>dbusername</con:name><con:value>ws_stub</con:value></con:property><con:property><con:name>dbpassword</con:name><con:value>test</con:value></con:property><con:property><con:name>dbport</con:name><con:value>1521</con:value></con:property><con:property><con:name>dbtype</con:name><con:value>oracle</con:value></con:property></con:properties><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>